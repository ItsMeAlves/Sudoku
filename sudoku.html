<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">
	<link href='css/bootstrap.css' rel='stylesheet'>
	<title>Sudoku - <3 e Scala</title>
</head>
<body class='container'>
	<div class='center'>
		<h1 class='cabecalho'>Sudoku! <3 e Scala</h1>
		<h4>Clique nas celulas para definir valores iniciais e, depois, clique em iniciar!</h4>
		<h4>O computador vai te mostrar a resposta.</h4>
		<h5>A página será recarregada caso os valores iniciais representem um tabuleiro inválido.</h5>
	</div>
	<br>
	<table class='center table table-bordered'>
		<tbody id='fields'>
			<tr id='id1'>
				<td id='l1c1' class='cinza field'>-</td>
				<td id='l1c2' class='cinza field'>-</td>
				<td id='l1c3' class='cinza field'>-</td>
				<td id='l1c4' class='field'>-</td>
				<td id='l1c5' class='field'>-</td>
				<td id='l1c6' class='field'>-</td>
				<td id='l1c7' class='cinza field'>-</td>
				<td id='l1c8' class='cinza field'>-</td>
				<td id='l1c9' class='cinza field'>-</td>
			</tr>
			<tr id='id2'>
				<td id='l2c1' class='cinza field'>-</td>
				<td id='l2c2' class='cinza field'>-</td>
				<td id='l2c3' class='cinza field'>-</td>
				<td id='l2c4' class='field'>-</td>
				<td id='l2c5' class='field'>-</td>
				<td id='l2c6' class='field'>-</td>
				<td id='l2c7' class='cinza field'>-</td>
				<td id='l2c8' class='cinza field'>-</td>
				<td id='l2c9' class='cinza field'>-</td>
			</tr>
			<tr id='id3'>
				<td id='l3c1' class='cinza field'>-</td>
				<td id='l3c2' class='cinza field'>-</td>
				<td id='l3c3' class='cinza field'>-</td>
				<td id='l3c4' class='field'>-</td>
				<td id='l3c5' class='field'>-</td>
				<td id='l3c6' class='field'>-</td>
				<td id='l3c7' class='cinza field'>-</td>
				<td id='l3c8'class='cinza field'>-</td>
				<td id='l3c9' class='cinza field'>-</td>
			</tr>
			<tr id='id4'>
				<td id='l4c1' class='field'>-</td>
				<td id='l4c2' class='field'>-</td>
				<td id='l4c3' class='field'>-</td>
				<td id='l4c4' class='cinza field'>-</td>
				<td id='l4c5' class='cinza field'>-</td>
				<td id='l4c6' class='cinza field'>-</td>
				<td id='l4c7' class='field'>-</td>
				<td id='l4c8' class='field'>-</td>
				<td id='l4c9' class='field'>-</td>
			</tr>
			<tr id='id5'>
				<td id='l5c1' class='field'>-</td>
				<td id='l5c2' class='field'>-</td>
				<td id='l5c3' class='field'>-</td>
				<td id='l5c4' class='cinza field'>-</td>
				<td id='l5c5' class='cinza field'>-</td>
				<td id='l5c6' class='cinza field'>-</td>
				<td id='l5c7' class='field'>-</td>
				<td id='l5c8'class='field'>-</td>
				<td id='l5c9' class='field'>-</td>
			</tr>
			<tr id='id6'>
				<td id='l6c1' class='field'>-</td>
				<td id='l6c2' class='field'>-</td>
				<td id='l6c3' class='field'>-</td>
				<td id='l6c4' class='cinza field'>-</td>
				<td id='l6c5' class='cinza field'>-</td>
				<td id='l6c6' class='cinza field'>-</td>
				<td id='l6c7' class='field'>-</td>
				<td id='l6c8' class='field'>-</td>
				<td id='l6c9' class='field'>-</td>
			</tr>
			<tr id='id7'>
				<td id='l7c1' class='cinza field'>-</td>
				<td id='l7c2' class='cinza field'>-</td>
				<td id='l7c3' class='cinza field'>-</td>
				<td id='l7c4' class='field'>-</td>
				<td id='l7c5' class='field'>-</td>
				<td id='l7c6' class='field'>-</td>
				<td id='l7c7' class='cinza field'>-</td>
				<td id='l7c8' class='cinza field'>-</td>
				<td id='l7c9' class='cinza field'>-</td>
			</tr>
			<tr id='id8'>
				<td id='l8c1' class='cinza field'>-</td>
				<td id='l8c2' class='cinza field'>-</td>
				<td id='l8c3' class='cinza field'>-</td>
				<td id='l8c4' class='field'>-</td>
				<td id='l8c5' class='field'>-</td>
				<td id='l8c6' class='field'>-</td>
				<td id='l8c7' class='cinza field'>-</td>
				<td id='l8c8' class='cinza field'>-</td>
				<td id='l8c9' class='cinza field'>-</td>
			</tr>
			<tr id='id9'>
				<td id='l9c1' class='cinza field'>-</td>
				<td id='l9c2' class='cinza field'>-</td>
				<td id='l9c3' class='cinza field'>-</td>
				<td id='l9c4' class='field'>-</td>
				<td id='l9c5' class='field'>-</td>
				<td id='l9c6' class='field'>-</td>
				<td id='l9c7' class='cinza field'>-</td>
				<td id='l9c8' class='cinza field'>-</td>
				<td id='l9c9' class='cinza field'>-</td>
			</tr>
		</tbody>
	</table>
	<button id='btn-principal' class='btn btn-primary btn-block btn-primary'>Iniciar!</button>
	<br>
	<footer class='center rodape'>
		&copy; Gabriel Alves de Lima - Linguagem de Programação Funcional 2015.2 - Professor Luís Carlos Menezes - Engenharia da Computação - UPE
	</footer>

	<script type="text/javascript">
		for(var a = 1; a <= 9; a += 1) {
			for(var b = 1; b <= 9; b += 1) {
				var element = document.getElementById("l" + a + "c" + b);
				element.addEventListener("click", function() {
					if(this.textContent === "-") {
						this.textContent = "1";
					}
					else if(this.textContent === "9") {
						this.textContent = "-";
					}
					else {
						this.textContent = "" + (parseInt(this.textContent) + 1)
					}
				});
			} 
		}
	</script>

	<script type="text/javascript">
		function obterArrayDoHTML() {
    var array = [];
    var coluna = 1;
    var linha = 1;
    for (var linha = 1; linha <= 9; ++linha) {
      var aux = [];
      for (var coluna = 1; coluna <= 9; ++coluna) {
        var element = document.getElementById((("l" + linha) + "c") + coluna).textContent;
        aux.push(parseInt(element));
      };
      array.push(aux);
    };
    if (!verificaValidade(array)) {
      console.log("Tabuleiro inválido! Recarregando...");
      document.location.reload(true);
    };
    return array;
  };
  function verificaValidade(vetor) {
    function verificaPertinenciaMultipla(array) {
      var resposta = false;
      if (array.length == 1) return resposta;
      var head = array.slice(0, 1);
      var tail = array.slice(1, array.length);
      if (tail.indexOf(head[0]) > -1) {
        resposta = true;
        return resposta;
      } else return verificaPertinenciaMultipla(tail);
    };
    var a = true;
    var b = true;
    var c = true;
    var linha = 0;
    for (var linha = 0; linha <= 8; ++linha) if (verificaPertinenciaMultipla(vetor[linha])) {
      console.log("linha invalido");
      a = a && false;
    } else {
      console.log("linha valido");
      a = a && true;
    };
    var coluna = 0;
    var colunas = [];
    for (var coluna = 0; coluna <= 8; ++coluna) {
      colunas = [];
      for (var linha = 0; linha <= 8; ++linha) colunas.push(vetor[linha][coluna]);
      if (verificaPertinenciaMultipla(colunas)) {
        console.log("coluna invalida");
        b = b && false;
      } else {
        console.log("coluna valida");
        b = b && true;
      };
    };
    var quadrantes = [];
    var ka = 0;
    var kb = 0;
    while ((ka < 3) || (kb < 2)) {
      if (ka >= 3) {
        ka = 0;
        kb = kb + 1;
      };
      quadrantes = [];
      for (var linha = ka * 3; linha <= ((ka * 3) + 2); ++linha) for (var coluna = kb * 3; coluna <= ((kb * 3) + 2); ++coluna) quadrantes.push(vetor[linha][coluna]);
      if (verificaPertinenciaMultipla(quadrantes)) {
        console.log("quadrante invalido");
        c = c && false;
      } else {
        console.log("quadrante valido");
        c = c && true;
      };
      ka = ka + 1;
    };
    return (a && b) && c;
  };
  function verificaSolucao(vetor) {
    var a = 0;
    var b = 0;
    for (var a = 0; a <= 8; ++a) for (var b = 0; b <= 8; ++b) if (isNaN(vetor[a][b])) return false;
    return true;
  };
  function listaJogadasValidas(v) {
    if (verificaSolucao(v)) {
      console.log("sem jogadas válidas");
      return [];
    } else {
      var possibilidades = [];
      var linha = 0;
      var coluna = 0;
      var trava = true;
      while (trava) {
        isNaN(v[linha][coluna]) ? trava = false : coluna = coluna + 1;
        if (coluna > 8) {
          coluna = 0;
          linha = linha + 1;
        };
      };
      for (var valor = 1; valor <= 9; ++valor) {
        var novaPossibilidade = v.slice(0, v.length);
        novaPossibilidade[linha][coluna] = valor;
        novaPossibilidade = novaPossibilidade.slice(0, novaPossibilidade.length)
        if (verificaValidade(novaPossibilidade)) possibilidades.push(novaPossibilidade);
      };
      return possibilidades;
    };
  };
  function resolve(x) {
    function atualizaHTML(vetor) {
      var linha = 0;
      var coluna = 0;
      for (var linha = 0; linha <= 8; ++linha) for (var coluna = 0; coluna <= 8; ++coluna) {
        var element = document.getElementById((("l" + (linha + 1)) + "c") + (coluna + 1));
        element.textContent = "" + vetor[linha][coluna];
      };
    };
    if (verificaSolucao(x)) {
      console.log("resposta!");
      atualizaHTML(x);
    } else {
      var a = 0;
      var proximasJogadas = listaJogadasValidas(x);
      for (var a = 0; a <= (proximasJogadas.length - 1); ++a) resolve(proximasJogadas[a]);
    };
  };
  var btn = document.getElementById("btn-principal");
  btn.addEventListener("click", function () {
      if (btn.textContent != "Reiniciar!") {
        btn.textContent = "Reiniciar!";
        console.log("resolve");
        resolve(obterArrayDoHTML());
      } else {
        btn.textContent = "Iniciar!";
        document.location.reload(true);
      };
    });

	</script>


</body>
</html>